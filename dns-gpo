You **cannot directly run Cloudbase-Init** through Group Policy (GPO).
Cloudbase-Init is a *first-boot provisioning engine* that runs **before** the machine joins the domain ‚Äî GPO applies **only after** a VM is already domain-joined.

BUT‚Ä¶ you *can absolutely* deliver the **same DNS-fix logic** AFTER join using GPO in several clean ways.

Below I‚Äôll show you **exactly how to convert the Cloudbase-Init DNS fix** into a GPO version.

---

# ‚úÖ First ‚Äî What You *Can* Do With GPO

GPO **can**:

### ‚úî Push registry changes

(Perfect for clearing and setting DNS SearchList)

### ‚úî Run startup scripts

(Equivalent to what your Cloudbase-Init PowerShell did)

### ‚úî Enforce DNS Suffix Search List

(Native GPO setting)

### ‚úî Disable DNS Devolution

(Native GPO setting)

### ‚úî Ensure DNS never drifts again

(Very important after join)

---

# üö´ What GPO *Cannot* Do

* It **cannot run before OS boot**
* It **cannot replace Cloudbase-Init functionality**
* It **cannot fix the DNS issue *before* domain join**
  (because GPO is applied *after* successful join)

So GPO is **not a replacement** for Cloudbase-Init.
It is a **reinforcement** ‚Äî it ensures your fix stays permanent.

---

# üß∞ So What You Want Is:

### **‚ÄúHow do I enforce the DNS fix via GPO after domain join?‚Äù**

Here‚Äôs how:

---

# üî• **Option 1 ‚Äî Native GPO (Recommended)**

### Path:

**Computer Configuration ‚Üí Administrative Templates ‚Üí Network ‚Üí DNS Client**

Configure these two policies:

### ‚úî **1. DNS Suffix Search List**

Enable ‚Üí
Set value to:

```
corp.example.com
```

### ‚úî **2. Primary DNS Suffix Devolution**

Enable ‚Üí
Set to **Disabled** (or set level = 0)

This GPO alone will make sure:

* The SearchList *only* contains your domain
* Windows does not append devolved suffixes
* Cloudbase-Init settings never get overwritten by DHCP or NLA
* Domain-joined machines stay compliant forever

---

# üî• **Option 2 ‚Äî GPO Startup Script (PowerShell)**

If you prefer an exact 1:1 of your Cloudbase-Init script, use this:

### GPO Path:

**Computer Configuration ‚Üí Policies ‚Üí Windows Settings ‚Üí Scripts (Startup)**

Add a `.ps1` script with:

```powershell
# Clear existing DNS SearchList (if present)
Remove-ItemProperty `
  -Path 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' `
  -Name 'SearchList' `
  -ErrorAction SilentlyContinue

# Set domain suffix
Set-ItemProperty `
  -Path 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' `
  -Name 'SearchList' -Value 'corp.example.com'

# Disable devolution
Set-ItemProperty `
  -Path 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' `
  -Name 'UseDomainNameDevolution' `
  -Type DWord `
  -Value 0
```

### Notes:

* No reboot needed ‚Äî applied on startup.
* This script **exactly mirrors** your Cloudbase-Init logic.

---

# üî• **Option 3 ‚Äî GPP Registry Item (No scripting)**

### Path:

**Computer Configuration ‚Üí Preferences ‚Üí Windows Settings ‚Üí Registry**

Add 2 registry items:

---

### **Registry item #1**

**Action:** Replace
**Hive:** `HKEY_LOCAL_MACHINE`
**Key Path:**

```
SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
```

**Value Name:** `SearchList`
**Type:** REG_SZ
**Value:** `corp.example.com`

---

### **Registry item #2**

**Action:** Replace
**Hive:** `HKEY_LOCAL_MACHINE`
**Key Path:**

```
SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
```

**Value Name:** `UseDomainNameDevolution`
**Type:** REG_DWORD
**Value:** `0`

---

# üß† Summary ‚Äî Best Practice Workflow

| Stage                 | Tool                                 | Purpose                                                  |
| --------------------- | ------------------------------------ | -------------------------------------------------------- |
| **During Deployment** | **Cloudbase-Init**                   | Fix broken DNS settings in SAP Windows image before join |
| **After Domain Join** | **GPO (native DNS Client policies)** | Enforce DNS suffix and disable devolution                |
| Optional              | **GPO Startup Script**               | Mirrors Cloudbase-Init logic for consistency             |
| Optional              | **GPP Registry**                     | GUI version of startup script                            |

This gives you a **full lifecycle fix** even when you cannot modify the base image.

---

# If You Want

I can generate:

### ‚úî A pre-built **GPO XML backup** you can import

### ‚úî A `.ps1` file ready for ‚ÄúStartup Scripts‚Äù

### ‚úî A GPP Registry .REG file

### ‚úî A full write-up for your AD team

Just tell me which format you want.
